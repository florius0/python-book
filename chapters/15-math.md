# 10. Математические возможности Python

## 1. Модуль `math`

Модуль `math` содержит в себе функции и константы, которые могут пригодиться при работе с математикой. Вот некоторые из них:

- `math.pi` — число π
- `math.e` — число e
- `math.sin(x)` — синус числа x
- `math.cos(x)` — косинус числа x
- `math.tan(x)` — тангенс числа x
- `math.asin(x)` — арксинус числа x
- `math.acos(x)` — арккосинус числа x
- `math.atan(x)` — арктангенс числа x
- `math.atan2(y, x)` — арктангенс числа y/x
- `math.sinh(x)` — гиперболический синус числа x
- `math.cosh(x)` — гиперболический косинус числа x
- `math.tanh(x)` — гиперболический тангенс числа x
- `math.asinh(x)` — аркгиперболический синус числа x
- `math.acosh(x)` — аркгиперболический косинус числа x
- `math.atanh(x)` — аркгиперболический тангенс числа x
- `math.radians(x)` — переводит градусы в радианы
- `math.degrees(x)` — переводит радианы в градусы
- `math.exp(x)` — экспонента числа x
- `math.log(x)` — натуральный логарифм числа x
- `math.log10(x)` — десятичный логарифм числа x
- `math.log2(x)` — двоичный логарифм числа x
- `math.sqrt(x)` — квадратный корень числа x
- `math.ceil(x)` — округление числа x в большую сторону
- `math.floor(x)` — округление числа x в меньшую сторону
- `math.factorial(x)` — факториал числа x
- `math.gcd(a, b)` — наибольший общий делитель чисел a и b
- `math.isfinite(x)` — проверяет, является ли число x конечным
- `math.isinf(x)` — проверяет, является ли число x бесконечным
- `math.isnan(x)` — проверяет, является ли число x нечислом (NaN)
- `math.trunc(x)` — отбрасывает дробную часть числа x

Пример:

<!--
filename: chapter_15/math.py
-->

```python
import math

print(math.pi)
print(math.e)
print(math.sin(math.pi / 2))
print(math.cos(math.pi))
print(math.tan(math.pi / 4))
print(math.asin(1))
print(math.acos(1))
print(math.atan(1))
print(math.atan2(1, 1))
print(math.sinh(1))
print(math.cosh(1))
print(math.tanh(1))
print(math.asinh(1))
print(math.acosh(1))
print(math.atanh(1))
print(math.radians(180))
print(math.degrees(math.pi))
print(math.exp(1))
print(math.log(1))
print(math.log10(1))
print(math.log2(1))
print(math.sqrt(4))
print(math.ceil(1.1))
print(math.floor(1.9))
print(math.factorial(5))
print(math.gcd(12, 18))
print(math.isfinite(1))
print(math.isinf(1))
print(math.isnan(1))
print(math.trunc(1.9))
```

<!--
runs: chapter_15/math.py
stdout: >
    3.141592653589793
    2.718281828459045
    1.0
    -1.0
    0.9999999999999999
    1.5707963267948966
    0.0
    0.7853981633974483
    0.7853981633974483
    1.1752011936438014
    1.5430806348152437
    0.7615941559557649
    0.881373587019543
    0.0
    0.7615941559557649
    3.141592653589793
    180.0
    2.718281828459045
    0.0
    0.0
    0.0
    2.0
    2
    1
    1
    120
    6
    True
    False
    False
    1
-->

## 2. Модуль `decimal`

Модуль `decimal` предоставляет класс `Decimal`, который позволяет работать с точными десятичными числами.

Конструкторы:

1. `Decimal(x)` — создаёт объект `Decimal` из числа `x`
2. `Decimal()` – эквивалентно `Decimal('0')`
3. `Decimal((sign, digits, exponent))` — создаёт объект `Decimal` из кортежа `(sign, digits, exponent)`, где `sign` – знак числа (0 – положительное, 1 – отрицательное), `digits` – кортеж цифр числа, `exponent` – экспонента числа.

### 1. Контекст

Существуют дополнительные параметры работы с числами – контекст. Контекст позволяет задать точность вычислений, а так же режим округления. Чтобы получить контекст, нужно воспользоваться функцией `getcontext()`, которая возвращает объект `Context`, который имеет следующие атрибуты:

- `prec` — точность вычислений (количество цифр после запятой)
- `rounding` — режим округления
- `Emin` — минимальное значение экспоненты (по умолчанию – `-999999`)
- `Emax` — максимальное значение экспоненты (по умолчанию – `999999`)
- и другие, которые не будут рассмотрены.

Для того, чтобы установить какой-либо параметр текущего контекста, достаточно просто присвоить ему значение. Чтобы изменить контекст, нужно воспользоваться функцией `setcontext()`, которая принимает объект `Context` в качестве аргумента.

Режимы режимы округления:

1. `ROUND_CEILING` – Округлять к положительной бесконечности.
2. `ROUND_DOWN` – Округлять к нулю.
3. `ROUND_FLOOR` – Округлять к отрицательной бесконечности.
4. `ROUND_HALF_DOWN` – Округлять к ближайшему целому. 0.5 округляется к 0.
5. `ROUND_HALF_EVEN` – Округлять к ближайшему целому. 0.5 округляется к ближайшему чётному (по умолчанию).
6. `ROUND_HALF_UP` – Округлять к ближайшему целому. 0.5 округляется к 1.
7. `ROUND_UP` – Округлять к бесконечности соответствующего знака (округление в математическом смысле).

### 2. Работа с `Decimal`

Для `Decimal` определены все математические операторы. По умолчанию, бинарные операции работают только с числами типа `Decimal` и `int` (целыми числами).

Некоторые методы класса `Decimal`:

- `Decimal.min(other)` — возвращает минимальное из двух чисел
- `Decimal.max(other)` — возвращает максимальное из двух чисел
- `Decimal.log10()` — возвращает логарифм по основанию 10
- `Decimal.logb()` — возвращает логарифм по основанию 2
- `Decimal.ln()` — возвращает натуральный логарифм
- `Decimal.exp()` — возвращает экспоненту (`e` в степени числа)

Пример:

<!--
filename: chapter_15/decimal.py
-->

```python
import decimal
from decimal import Decimal

decimal.getcontext().prec = 100 # Устанавливаем точность вычислений в 100 знаков после запятой
decimal.getcontext().rounding = decimal.ROUND_UP # Устанавливаем режим округления как в математике

print(Decimal('1'))                    # Decimal('1')
print(Decimal(1))                      # Decimal('1')
print(Decimal((0, (1,), 0)))           # Decimal('1')

from decimal impoor Decimal as D

print(D('1.1') + D('2.2'))             # Decimal('3.3')
print(D('1.1') + 2)                    # Decimal('3.3')

print(D('1.1') + D('2.2') == D('3.3')) # True
print(D('1.1') + D('2.2') == 3.3)      # False
print(1.1 + 2.2 == 3.3)                # False (потому что 1.1 + 2.2 = 3.3000000000000003)

print(D('1.1') * D('2.2'))             # Decimal('2.42')  
```

<!--
runs: chapter_15/decimal.py
stdout: >
    Decimal('1')
    Decimal('1')
    Decimal('1')
    Decimal('3.3')
    Decimal('3.3')
    True
    False
    False
    Decimal('2.42')
-->

### 3. О точности и применении `Decimal` и неточности `float`

В Python числа `float` соответствуют стандарту IEEE 754 и на самом деле не являются десятичными, а двоичными. Поэтому, при создании числа `float` из десятичного числа, оно округляется до ближайшего двоичного числа с плавающей точкой. Например, число 0.1 будет округлено до 0.1000000000000000055511151231257827021181583404541015625 (именно эта особенность является основным источником неточности `float`, попробуйте посчитать в Python `0.1 + 0.2 + ... + 0.9`).

Числа `Decimal` же являются десятичными и в следствии этого, лишенными данной проблемы. Поэтому, если вы хотите точно вычислять десятичные числа, то используйте `Decimal`.

Так же, и у чисел типа `float`, и у чисел типа `Decimal` есть ограничения размера (и как в следствии этого, точности), но у `Decimal` она настолько большая, что для большинства практических задач можно считать числа `Decimal` абсолютно точными.

| Число     | Разрядность ОС | Минимальное значение  | Максимальное значение | Точность                                |
| --------- | -------------- | --------------------- | --------------------- | --------------------------------------- |
| `float`   | 32             | 1.2e-38               | 3.4e+38               | 7 знаков после запятой                  |
| `float`   | 64             | 2.2e-308              | 1.8e+308              | 16 знаков после запятой                 |
| `Decimal` | 32             | 1e-425000000          | 9e+425000000          | 425000000 знаков после запятой          |
| `Decimal` | 64             | 1e-999999999999999999 | 9e+999999999999999999 | 999999999999999999 знаков после запятой |

Основная область применения `Decimal` – это финансовые расчёты, где точность вычислений очень важна. Для тяжелых математических вычислений `Decimal` применяется редко в связи с их низкой производительностью, в следствии того, что операции с `float` реализованны на физическом уровне процессора, а операции с `Decimal` – на уровне языка программирования.

Следует знать, что `Decimal` не является заменой `float`. Они предназначены для разных задач. `Decimal` – для точных вычислений, а `float` – для быстрых вычислений.
