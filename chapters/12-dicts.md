# 13. Работа со словарями (`dict` и другие)

## 1. `dict`

Мутабельный тип данных.

Представляет собой отображение хэшируемых объектов в произвольные объекты.

Литерал – `{key1: value1, key2: value2, ... keyN: valueN}`. Литерал пустого словаря – `{}`.

Конструкторы:

1. `dict()` – создает пустой словарь
2. `dict(key1=value1, key2=value2, ... keyN=valueN)` – создает словарь вида `{'key1': value1, 'key2': value2, ... 'keyN': valueN}`
3. `dict(mapping, key1=value1 ...)` – создает новый словарь из существующего, добавляя или обновляя элементы словаря, переданные как опциональные именованные параметры (`key1=value1 ...`)
4. `dict(iterable, key1=value1 ...)` – создает новый словарь из итерируемого объекта, содержащего итерируемые объекты – пары ключ-значение (например, [(key1, value1), (key2, value2), ... (keyN, valueN)]), добавляя или обновляя элементы словаря, переданные как опциональные именованные параметры

Словарь – тоже итерируемый объект, и итерация происходит по ключам. В этом можно убедится при помощи конструктора `list` следующим образом:

<!--
filename: chapter_12/dict_iteration.py
-->

```python
d = {'a': 1, 'b': 2}
print(list(d))
```

<!--
runs: chapter_12/dict_iterator.py
stdout: >
    ['a', 'b']
-->

Результатом выполнения указанного выше кода будет `['a', 'b']`

Для `dict` определены следующие операции:

| Операция              | Результат                                                                                                                                                                                                          |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `d[key] = value`      | Добавляет или обновляет значение в словаре, соответствующее ключу                                                                                                                                                  |
| `del d[key]`          | Удаляет пару ключ – значении из словаря. Если ключа в словаре нет – вызывает исключение `KeyError`                                                                                                                 |
| `key in d`            | `True` если в словаре есть ключ, иначе `False`                                                                                                                                                                     |
| `key not in d`        | Эквивалентно `not key in d`                                                                                                                                                                                        |
| `d.clear()`           | Удаляет все элементы из словаря                                                                                                                                                                                    |
| `d.copy()`            | Копирует словарь (только словарь, но не его элементы)                                                                                                                                                              |
| `d.get(key, default)` | Получает значение, соответствующее ключу или `default`, если ключа в словаре нет. `default` – опциональный параметр и равен по умолчанию `None`                                                                    |
| `d.items()`           | Возвращает итерируемый объект с парами ключ-значение                                                                                                                                                               |
| `d.keys()`            | Возвращает итерируемый объект с ключами словаря                                                                                                                                                                    |
| `d.values()`          | Возвращает итерируемый объект со значениями словаря                                                                                                                                                                |
| `d.pop(key, default)` | Возвращает значение, соответствующее словарю и удаляет пару ключ-значение из словаря. Если ключа в словаре – опциональный параметр `default`. Если `default` не указан и ключа в словаре нет – вызывает `KeyError` |
| `d.popitem()`         | Возвращает пару ключ-значение и удаляет ее из словаря в порядке Last-In-First-Out                                                                                                                                  |
| `d.update(other)`     | Добавляет и обновляет пары ключ-значения парами из словаря other                                                                                                                                                   |

где `d`, `other` – словарь, `key` – ключ, `value` – значение

Пример:

<!--
filename: chapter_12/dict.py
-->

```python
d = {'a': 1, 'b': 2}

d['c'] = 3
print(d) # {'a': 1, 'b': 2, 'c': 3}

del d['b']
print(d) # {'a': 1, 'c': 3}

print('a' in d) # True
print('b' in d) # False

d.clear()
print(d) # {}

d = {'a': 1, 'b': 2}

print(d.get('a')) # 1
print(d.get('c')) # None

print(d.get('c', 3)) # 3

print(d.items()) # dict_items([('a', 1), ('b', 2)])
print(d.keys()) # dict_keys(['a', 'b'])
print(d.values()) # dict_values([1, 2])

print(d.pop('a')) # 1
print(d) # {'b': 2}

print(d.pop('c', 3)) # 3
print(d) # {'b': 2}

print(d.popitem()) # ('b', 2)
print(d) # {}

d = {'a': 1, 'b': 2}
d.update({'c': 3, 'd': 4})

print(d) # {'a': 1, 'b': 2, 'c': 3, 'd': 4}
```

<!--
runs: chapter_12/dict.py
stdout: >
    {'a': 1, 'b': 2, 'c': 3}
    {'a': 1, 'c': 3}
    True
    False
    {}
    1
    None
    3
    dict_items([('a', 1), ('b', 2)])
    dict_keys(['a', 'b'])
    dict_values([1, 2])
    1
    {'b': 2}
    3
    {'b': 2}
    ('b', 2)
    {}
    {'a': 1, 'b': 2, 'c': 3, 'd': 4}
-->

## 2. `defaultdict`

`defaultdict` – это подкласс словаря, который позволяет задавать значение по умолчанию для ключей, которых нет в словаре.
Распологается в модуле `collections` (подробнее о модулях в 14ой главе).

Конструкторы:

1. `defaultdict(default_factory)`, где `default_factory` – функция, которая возвращает значение по умолчанию или None.
2. `defaultdict()` – эквивалентен `defaultdict(None)`

Пример:

<!--
filename: chapter_12/defaultdict.py
-->

```python
# импортируем defaultdict из collections
from collections import defaultdict

# создаем словарь с функцией, которая возвращает 0
d = defaultdict(int)

# добавляем ключи
d['a'] = 1
d['b'] = 2

# пытаемся получить значение для ключа 'c'
print(d['c']) # 0

# создаем словарь с функцией, которая возвращает пустой список
d = defaultdict(list)

# добавляем ключи
d['a'] = [1, 2, 3]

# Сейчас словарь выглядит так:
print(d) # {'a': [1, 2, 3]}

# пытаемся получить значение для ключа 'b'
print(d['b']) # []

# добавляем элемент в список по ключу 'b'
d['b'].append(4)

print(d) # {'a': [1, 2, 3], 'b': [4]}
```

<!--
runs: chapter_12/defaultdict.py
stdout: >
    0
    {'a': [1, 2, 3]}
    []
    {'a': [1, 2, 3], 'b': [4]}
-->

## 3. `OrderedDict`

`OrderedDict` – это подкласс словаря, который сохраняет порядок добавления ключей.

Конструкторы:

1. `OrderedDict(mapping)`, где `mapping` – словарь, который нужно скопировать.
2. `OrderedDict()` – эквивалент `OrderedDict({})`.

Методы:

1. `move_to_end(key, last=True)`, перемещает пару ключ-значение в конец или в начало словаря. `key` – ключ, который нужно переместить, `last` – переместить в конец или в начало.
2. `popitem(last=True)`, удаляет пару ключ-значение из начала или конца словаря и возвращает ее в виде кортежа. `last` – удалять из конца или из начала.

Удобен для написания LRU-кэша (Least Recently Used – наименее недавно использованный).

Пример:

<!--
filename: chapter_12/ordereddict.py
-->

```python
# импортируем OrderedDict из collections
from collections import OrderedDict

# создаем словарь
d = OrderedDict()

# добавляем ключи
d['a'] = 1
d['b'] = 2
d['c'] = 3

print(d) # OrderedDict([('a', 1), ('b', 2), ('c', 3)])

# перемещаем ключ 'b' в конец
d.move_to_end('b')
print(d) # OrderedDict([('a', 1), ('c', 3), ('b', 2)])

# Перемещаем ключ 'c' в начало
d.move_to_end('c', last=False)
print(d) # OrderedDict([('a', 1), ('c', 3), ('b', 2)])

# удаляем пару ключ-значение из начала
print(d.popitem(last=False)) # ('a', 1)

# удаляем пару ключ-значение из конца
print(d.popitem()) # ('b', 2)

print(d) # OrderedDict([('c', 3)])
```

<!--
runs: chapter_12/ordereddict.py
stdout: >
    OrderedDict([('a', 1), ('b', 2), ('c', 3)])
    OrderedDict([('a', 1), ('c', 3), ('b', 2)])
    OrderedDict([('c', 3), ('a', 1), ('b', 2)])
    ('a', 1)
    ('b', 2)
    OrderedDict([('c', 3)])
-->
